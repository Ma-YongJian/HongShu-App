!function(e,n){for(var t in n)e[t]=n[t]}(exports,function(e){var n={};function t(o){if(n[o])return n[o].exports;var r=n[o]={i:o,l:!1,exports:{}};return e[o].call(r.exports,r,r.exports,t),r.l=!0,r.exports}return t.m=e,t.c=n,t.d=function(e,n,o){t.o(e,n)||Object.defineProperty(e,n,{enumerable:!0,get:o})},t.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},t.t=function(e,n){if(1&n&&(e=t(e)),8&n)return e;if(4&n&&"object"==typeof e&&e&&e.__esModule)return e;var o=Object.create(null);if(t.r(o),Object.defineProperty(o,"default",{enumerable:!0,value:e}),2&n&&"string"!=typeof e)for(var r in e)t.d(o,r,function(n){return e[n]}.bind(null,r));return o},t.n=function(e){var n=e&&e.__esModule?function(){return e.default}:function(){return e};return t.d(n,"a",n),n},t.o=function(e,n){return Object.prototype.hasOwnProperty.call(e,n)},t.p="",t(t.s=1)}([function(e,n,t){"use strict";function o(e){return(o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function r(e,n,t){n?n.errMsg||(n.errMsg="callback:ok"):"object"===o(t)?(t||(t={errMsg:"callback:fail"}),t.errMsg||(t.errMsg=t.message||"callback:fail")):t={errMsg:"callback:fail "+String(t)},e&&"function"==typeof e.success&&n&&e.success(n),t&&console.warn("Callback Fail:",t),e&&"function"==typeof e.fail&&t&&e.fail(t),e&&"function"==typeof e.complete&&e.complete(n||t)}Object.defineProperty(n,"__esModule",{value:!0}),n.getCallback=n.callback=n.plusReady=n.isApp=n.isWeex=n.isWeb=n.isPlus=void 0,n.isPlus="object"===("undefined"==typeof navigator?"undefined":o(navigator))&&!!navigator.userAgent.match(/Html5Plus/i),n.isWeb="object"===("undefined"==typeof document?"undefined":o(document))&&!n.isPlus,n.isWeex="object"===("undefined"==typeof weex?"undefined":o(weex)),n.isApp=n.isPlus||n.isWeex,n.plusReady=function(e){"object"===("undefined"==typeof plus?"undefined":o(plus))?e():n.isApp&&window.addEventListener("plusready",e,!1)},n.callback=r,n.getCallback=function(){return r}},function(e,n,t){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var o=t(2);Object.defineProperty(n,"connectSocket",{enumerable:!0,get:function(){return o.connectSocket}}),Object.defineProperty(n,"onSocketOpen",{enumerable:!0,get:function(){return o.onSocketOpen}}),Object.defineProperty(n,"onSocketError",{enumerable:!0,get:function(){return o.onSocketError}}),Object.defineProperty(n,"sendSocketMessage",{enumerable:!0,get:function(){return o.sendSocketMessage}}),Object.defineProperty(n,"onSocketMessage",{enumerable:!0,get:function(){return o.onSocketMessage}}),Object.defineProperty(n,"closeSocket",{enumerable:!0,get:function(){return o.closeSocket}}),Object.defineProperty(n,"onSocketClose",{enumerable:!0,get:function(){return o.onSocketClose}})},function(e,n,t){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.onSocketClose=n.closeSocket=n.onSocketMessage=n.sendSocketMessage=n.onSocketError=n.onSocketOpen=n.connectSocket=void 0;var o=t(3),r=null,a={};function c(e,n){r?r[e](n):a[e]=n}n.connectSocket=function(e){e=e||{};var n=new o.SocketTask(e);function t(){r=null}if(n.onClose(t),n.onError(t),!r)for(var c in r=n,a)a.hasOwnProperty(c)&&n[c](a[c]);return r=r||n,n},n.onSocketOpen=function(e){c("onOpen",e)},n.onSocketError=function(e){c("onError",e)},n.sendSocketMessage=function(e){r&&r.send(e)},n.onSocketMessage=function(e){c("onMessage",e)},n.closeSocket=function(e){r&&r.close(e)},n.onSocketClose=function(e){c("onClose",e)}},function(e,n,t){"use strict";function o(e){return(o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function r(e,n){for(var t=0;t<n.length;t++){var r=n[t];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,(a=r.key,c=void 0,c=function(e,n){if("object"!==o(e)||null===e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var r=t.call(e,n||"default");if("object"!==o(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===n?String:Number)(e)}(a,"string"),"symbol"===o(c)?c:String(c)),r)}var a,c}var a=this&&this.__createBinding||(Object.create?function(e,n,t,o){void 0===o&&(o=t),Object.defineProperty(e,o,{enumerable:!0,get:function(){return n[t]}})}:function(e,n,t,o){void 0===o&&(o=t),e[o]=n[t]}),c=this&&this.__setModuleDefault||(Object.create?function(e,n){Object.defineProperty(e,"default",{enumerable:!0,value:n})}:function(e,n){e.default=n}),i=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var n={};if(null!=e)for(var t in e)"default"!==t&&Object.hasOwnProperty.call(e,t)&&a(n,e,t);return c(n,e),n},s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(n,"__esModule",{value:!0}),n.SocketTask=void 0;var l,u,d=i(t(4)),f=t(0),b=s(t(5)),p={},y=t(6),v=!1,k=[];var h=function(){function e(n){!function(e,n){if(!(e instanceof n))throw new TypeError("Cannot call a class as a function")}(this,e),this.id=Date.now().toString(),this.eval("connect",n)}var n,o,a;return n=e,(o=[{key:"send",value:function(e){e.data&&"string"!=typeof e.data&&(e.data=[b.default.encode(e.data)]),this.eval("send",e)}},{key:"close",value:function(e){this.eval("close",e)}},{key:"onOpen",value:function(e){this.on("open",e)}},{key:"onClose",value:function(e){this.on("close",e)}},{key:"onError",value:function(e){this.on("error",e)}},{key:"onMessage",value:function(e){this.on("message",(function(n){n=(n=n.data)&&"string"!=typeof n?b.default.decode(n[0]):n,e({data:n})}))}},{key:"eval",value:function(e,n){var o="callback".concat(Date.now()),r=f.isWeb?window:p;r[o]=function(e){delete r[o],e?f.callback(n,{},e):f.callback(n,{})};var a="window.__webSocket&&__webSocket.".concat(e,"(").concat(this.id,",").concat(JSON.stringify(n),",'").concat(o,"')");f.isWeb?(l||(window.eval(y),l=!0),window.eval(a)):f.plusReady((function(){!function(e){var n=plus.webview.getWebviewById("__websocket__");if(!n){var o=t(7);(n=plus.webview.create("http://www.dcloud.io","__websocket__",{kernel:"WKWebview",render:"always",plusrequire:"none"})).overrideUrlLoading({match:".*data.*"},(function(e){var t=e.url,o=t.match(/\?(\S+)=(\S+)/);if(o){var r=o[1],a=JSON.parse(decodeURIComponent(o[2]));"event"===r?d.emit(a.type,a.data):"callback"===r&&p[a.callbackName](a.error)}else!v&&"number"!=typeof u&&t.indexOf("load")>=0?u=setInterval((function(){n.evalJS(y)}),16):!v&&t.indexOf("ready")>=0&&(clearInterval(u),v=!0,k.forEach((function(e){e(n)})),k=[])})),n.loadData(o,{baseURL:"http://websocket.websocket"})}v?e(n):k.push(e)}((function(e){e.evalJS(a)}))}))}},{key:"on",value:function(e,n){d.on("websocket".concat(e).concat(this.id),(function(e){n(e.detail)}))}}])&&r(n.prototype,o),a&&r(n,a),Object.defineProperty(n,"prototype",{writable:!1}),e}();n.SocketTask=h},function(e,n,t){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.emit=n.off=n.on=void 0;var o=t(0),r={};n.on=function(e,n){o.isWeb?window.addEventListener(e,n,!1):(r[e]=r[e]||[],r[e].push(n))},n.off=function(e,n){if(o.isWeb)window.removeEventListener(e,n,!1);else{var t=r[e];t&&t.splice(t.indexOf(n),1)}},n.emit=function(e,n){if(o.isWeb)document.dispatchEvent(new CustomEvent(e,{detail:n,bubbles:!0}));else{var t=r[e];t&&t.forEach((function(e){e({detail:n})}))}}},function(e,n,t){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var o={chars:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",lookup:null,encode:function(e){var n,t=this.chars,o=new Uint8Array(e),r=o.length,a="";for(n=0;n<r;n+=3)a+=t[o[n]>>2],a+=t[(3&o[n])<<4|o[n+1]>>4],a+=t[(15&o[n+1])<<2|o[n+2]>>6],a+=t[63&o[n+2]];return r%3==2?a=a.substring(0,a.length-1)+"=":r%3==1&&(a=a.substring(0,a.length-2)+"=="),a},decode:function(e){var n=this.chars,t=this.lookup;if(!t){t=this.lookup=new Uint8Array(256);for(var o=0;o<n.length;o++)t[n.charCodeAt(o)]=o}var r,a,c,i,s=.75*e.length,l=e.length,u=0;"="===e[e.length-1]&&(s--,"="===e[e.length-2]&&s--);var d=new ArrayBuffer(s),f=new Uint8Array(d);for(o=0;o<l;o+=4)r=t[e.charCodeAt(o)],a=t[e.charCodeAt(o+1)],c=t[e.charCodeAt(o+2)],i=t[e.charCodeAt(o+3)],f[u++]=r<<2|a>>4,f[u++]=(15&a)<<4|c>>2,f[u++]=(3&c)<<6|63&i;return d}};n.default=o},function(e,n){e.exports="(function () {\n    if (window.__webSocket) {\n        return\n    }\n    var isPlus = typeof navigator === 'object' && !!navigator.userAgent.match(/Html5Plus/i)\n    if (isPlus) {\n        location.href = 'http://data?ready'\n    }\n    // 自定义事件\n    var $event = {\n        emit (type, data) {\n            if (!isPlus) {\n                document.dispatchEvent(new CustomEvent(type, {\n                    detail: data,\n                    bubbles: true\n                }))\n                return\n            }\n            location.href = 'http://data?event=' + encodeURIComponent(JSON.stringify({\n                type,\n                data\n            }))\n        }\n    }\n    var Base64 = {\n        chars: \"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/\",\n        lookup: null,\n        encode: function (arraybuffer) {\n            var chars = this.chars;\n            var bytes = new Uint8Array(arraybuffer),\n                i, len = bytes.length, base64 = \"\";\n\n            for (i = 0; i < len; i += 3) {\n                base64 += chars[bytes[i] >> 2];\n                base64 += chars[((bytes[i] & 3) << 4) | (bytes[i + 1] >> 4)];\n                base64 += chars[((bytes[i + 1] & 15) << 2) | (bytes[i + 2] >> 6)];\n                base64 += chars[bytes[i + 2] & 63];\n            }\n\n            if ((len % 3) === 2) {\n                base64 = base64.substring(0, base64.length - 1) + \"=\";\n            } else if (len % 3 === 1) {\n                base64 = base64.substring(0, base64.length - 2) + \"==\";\n            }\n\n            return base64;\n        },\n        decode: function (base64) {\n            var chars = this.chars;\n            var lookup = this.lookup\n            if (!lookup) {\n                lookup = this.lookup = new Uint8Array(256);\n                for (var i = 0; i < chars.length; i++) {\n                    lookup[chars.charCodeAt(i)] = i;\n                }\n            }\n            var bufferLength = base64.length * 0.75,\n                len = base64.length, p = 0,\n                encoded1, encoded2, encoded3, encoded4;\n\n            if (base64[base64.length - 1] === \"=\") {\n                bufferLength--;\n                if (base64[base64.length - 2] === \"=\") {\n                    bufferLength--;\n                }\n            }\n\n            var arraybuffer = new ArrayBuffer(bufferLength),\n                bytes = new Uint8Array(arraybuffer);\n\n            for (i = 0; i < len; i += 4) {\n                encoded1 = lookup[base64.charCodeAt(i)];\n                encoded2 = lookup[base64.charCodeAt(i + 1)];\n                encoded3 = lookup[base64.charCodeAt(i + 2)];\n                encoded4 = lookup[base64.charCodeAt(i + 3)];\n\n                bytes[p++] = (encoded1 << 2) | (encoded2 >> 4);\n                bytes[p++] = ((encoded2 & 15) << 4) | (encoded3 >> 2);\n                bytes[p++] = ((encoded3 & 3) << 6) | (encoded4 & 63);\n            }\n\n            return arraybuffer;\n        }\n    }\n\n    window.__webSocket = {\n        webSockets: {},\n        connect (id, data, callbackName) {\n            var url = data.url\n            var header = data.header// 未支持\n            var method = data.method// 未支持\n            var protocols = data.protocols || []\n            var webSocket\n            try {\n                webSocket = this.webSockets[id] = new WebSocket(url, protocols)\n                webSocket.binaryType = 'arraybuffer'\n            } catch (error) {\n                this.callback(callbackName, error)\n                return\n            }\n            this.callback(callbackName)\n            if (webSocket) {\n                webSocket.addEventListener('open', () => {\n                    $event.emit(`websocketopen${id}`, {})\n                })\n                webSocket.addEventListener('message', ({ data }) => {\n                    $event.emit(`websocketmessage${id}`, {\n                        data: data && typeof data !== 'string' ? [Base64.encode(data)] : data\n                    })\n                })\n                webSocket.addEventListener('error', () => {\n                    $event.emit(`websocketerror${id}`, {})\n                })\n                webSocket.addEventListener('close', (event) => {\n                    $event.emit(`websocketclose${id}`, {\n                        code: event.code,\n                        reason: event.reason\n                    })\n                })\n            }\n        },\n        send (id, data = {}, callbackName) {\n            data = data.data\n            data = data && typeof data !== 'string' ? Base64.decode(data[0]) : data\n            try {\n                this.webSockets[id].send(data)\n            } catch (error) {\n                this.callback(callbackName, error)\n                return\n            }\n            this.callback(callbackName)\n        },\n        close (id, data = {}, callbackName) {\n            var options = []\n            options.push(data.code || 1000)\n            if (typeof data.reason === 'string') {\n                options.push(data.reason)\n            }\n            try {\n                this.webSockets[id].close(...options)\n            } catch (error) {\n                this.callback(callbackName, error)\n                return\n            }\n            this.callback(callbackName)\n        },\n        callback (callbackName, error) {\n            if (isPlus) {\n                location.href = 'http://data?callback=' + encodeURIComponent(JSON.stringify({\n                    callbackName,\n                    error\n                }))\n            } else {\n                var js = `window.${callbackName}&&window.${callbackName}('${error || ''}')`\n                window[callbackName] && window[callbackName](error | '')\n                window.eval(js)\n            }\n        }\n    }\n})()"},function(e,n){e.exports='<!doctype html> <html lang=en> <head> <meta charset=UTF-8> <title>WebSocket</title> </head> <body> <script>location.href="http://data/load"<\/script> </body> </html>'}]));