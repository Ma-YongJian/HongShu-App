(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["pages-message-message2"],{"0958":function(t,e,i){var a=i("c86c");e=a(!1),e.push([t.i,"[data-v-2ddd9cd1] .uni-scroll-view-refresh__spinner>circle{color:#8c8c8c!important}[data-v-2ddd9cd1] .uni-scroll-view-refresh-inner>svg{fill:#8c8c8c!important}[data-v-2ddd9cd1] .uni-scroll-view-refresh-inner{box-shadow:0 0 0 #fff}ul[data-v-2ddd9cd1]{padding:0;margin:%?35?%}ul li[data-v-2ddd9cd1]{list-style:none;border-bottom:1px solid #f1f1f1}.content .nav[data-v-2ddd9cd1]{display:flex;align-items:center}.page[data-v-2ddd9cd1]{height:95vh}.tabs[data-v-2ddd9cd1]{margin-top:%?12?%;height:%?120?%}.tabs-body[data-v-2ddd9cd1]{width:%?600?%;margin:auto;display:flex;justify-content:space-between;align-items:center}.tabs-body .item[data-v-2ddd9cd1]{position:relative;text-align:center}.tabs-body .item .name[data-v-2ddd9cd1]{font-size:%?28?%}.container[data-v-2ddd9cd1]{padding-bottom:env(safe-area-inset-bottom)}.tui-item-box[data-v-2ddd9cd1]{padding:5px 0 5px 0;width:100%;display:flex;align-items:center}.tui-msg-box[data-v-2ddd9cd1]{display:flex;align-items:center}.tui-msg-pic[data-v-2ddd9cd1]{width:%?100?%;height:%?100?%;border-radius:50%;display:block;margin-right:%?24?%;flex-shrink:0}.tui-msg-item[data-v-2ddd9cd1]{max-width:%?500?%;min-height:%?80?%;overflow:hidden;display:flex;flex-direction:column;justify-content:space-between}.tui-msg-name[data-v-2ddd9cd1]{overflow:hidden;white-space:nowrap;text-overflow:ellipsis;font-size:%?30?%;line-height:1;color:#262b3a}.tui-msg-content[data-v-2ddd9cd1]{overflow:hidden;white-space:nowrap;text-overflow:ellipsis;font-size:%?25?%;line-height:1;color:#9397a4}.tui-msg-right[data-v-2ddd9cd1]{max-width:%?180?%;height:%?88?%;margin-left:auto;text-align:right;display:flex;flex-direction:column;justify-content:space-between;align-items:flex-end}.tui-right-dot[data-v-2ddd9cd1]{height:%?76?%!important;padding-bottom:%?10?%!important}.tui-msg-time[data-v-2ddd9cd1]{width:100%;font-size:%?24?%;line-height:%?24?%;color:#9397a4}.tui-custom-btn_box[data-v-2ddd9cd1]{height:100%;display:flex;align-items:center;justify-content:left}.tui-cell-hover[data-v-2ddd9cd1]{background-color:#fff!important}.tui-custom-btn-top[data-v-2ddd9cd1]{width:50%;height:100%;background-color:#c8c7cd;text-align:center;line-height:%?88?%;color:#fff}.tui-custom-btn-delete[data-v-2ddd9cd1]{width:50%;height:100%;background-color:#fd3b31;text-align:center;line-height:%?88?%;color:#fff}.no-conversation[data-v-2ddd9cd1]{width:100%;text-align:center;height:%?80?%;line-height:%?80?%;font-size:%?34?%;color:#9d9d9d}.item-head_unread[data-v-2ddd9cd1]{padding:%?6?%;background-color:#ee593c;color:#fff;font-size:%?34?%;line-height:%?28?%;border-radius:50%;min-width:%?24?%;min-height:%?24?%;text-align:center;position:absolute;top:%?80?%;right:%?80?%}.unread-text[data-v-2ddd9cd1]{color:#d02129}",""]),t.exports=e},2371:function(t,e,i){"use strict";i.r(e);var a=i("e938"),n=i("d65f");for(var o in n)["default"].indexOf(o)<0&&function(t){i.d(e,t,(function(){return n[t]}))}(o);i("fb9b");var s=i("828b"),r=Object(s["a"])(n["default"],a["b"],a["c"],!1,null,"2ddd9cd1",null,!1,a["a"],void 0);e["default"]=r.exports},"47df":function(t,e,i){"use strict";i("6a54"),Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0,i("64aa"),i("5ef2"),i("5c47"),i("c223"),i("e966");var a={name:"tuiNavigationBar",emits:["init","change"],props:{title:{type:String,default:""},color:{type:String,default:"#333"},backgroundColor:{type:String,default:"#fff"},splitLine:{type:Boolean,default:!1},isOpacity:{type:Boolean,default:!0},maxOpacity:{type:[Number,String],default:1},transparent:{type:Boolean,default:!1},scrollTop:{type:[Number,String],default:0},scrollRatio:{type:[Number,String],default:.3},isCustom:{type:Boolean,default:!1},isImmersive:{type:Boolean,default:!0},isFixed:{type:Boolean,default:!0},backdropFilter:{type:Boolean,default:!1},dropDownHide:{type:Boolean,default:!1},zIndex:{type:[Number,String],default:996}},watch:{scrollTop:function(t,e){this.isOpacity&&!this.transparent&&this.opacityChange()},backgroundColor:function(t){t&&(this.background=this.hexToRgb(t))}},data:function(){return{width:375,left:375,height:44,top:0,scrollH:1,opacity:1,statusBarHeight:0,background:"255,255,255",dropDownOpacity:1}},created:function(){var t=this;this.dropDownOpacity=this.backdropFilter&&0,this.opacity=this.isOpacity||this.transparent?0:this.maxOpacity,this.background=this.hexToRgb(this.backgroundColor);var e={};uni.getSystemInfo({success:function(i){t.statusBarHeight=i.statusBarHeight,t.width=i.windowWidth,t.left=e.left||i.windowWidth,t.isImmersive&&(t.height=e.top?e.top+e.height+8:i.statusBarHeight+44),t.scrollH=i.windowWidth*t.scrollRatio,t.top=e.top?e.top+(e.height-32)/2:i.statusBarHeight+6,t.$emit("init",{width:t.width,height:t.height,left:t.left,top:t.top,statusBarHeight:t.statusBarHeight,opacity:t.opacity,windowHeight:i.windowHeight})}})},methods:{hexToRgb:function(t){var e="255,255,255";if(t&&~t.indexOf("#")){if(4===t.length){var i=t.substring(1,4);t="#"+i+i}var a=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(t);a&&(e="".concat(parseInt(a[1],16),",").concat(parseInt(a[2],16),",").concat(parseInt(a[3],16)))}return e},opacityChange:function(){this.dropDownHide&&(this.scrollTop<0?this.dropDownOpacity>0&&(this.dropDownOpacity=1-Math.abs(this.scrollTop)/30):this.dropDownOpacity=1);var t=this.scrollTop<=1?0:this.scrollTop,e=t/this.scrollH;this.opacity>=this.maxOpacity&&e>=this.maxOpacity||0==this.opacity&&0==e||(this.opacity=e>this.maxOpacity?this.maxOpacity:e,this.backdropFilter&&(this.dropDownOpacity=this.opacity>=this.maxOpacity?1:this.opacity),this.$emit("change",{opacity:this.opacity}))}}};e.default=a},"53dc":function(t,e,i){var a=i("c86c");e=a(!1),e.push([t.i,'.tui-navigation-bar[data-v-6d069bc1]{width:100%;transition:opacity .4s}.tui-backdrop__filter[data-v-6d069bc1]{\n\t/* Safari for macOS & iOS */-webkit-backdrop-filter:blur(15px);\n\t/* Google Chrome */backdrop-filter:blur(15px)}.tui-navbar-fixed[data-v-6d069bc1]{position:fixed;left:0;top:0}.tui-status-bar[data-v-6d069bc1]{width:100%}.tui-navigation_bar-title[data-v-6d069bc1]{width:100%;font-size:17px;line-height:17px;\nfont-weight:500;\nheight:32px;display:flex;align-items:center;justify-content:center}.tui-bar-line[data-v-6d069bc1]::after{content:"";position:absolute;border-bottom:%?1?% solid #eaeef1;-webkit-transform:scaleY(.5);transform:scaleY(.5);bottom:0;right:0;left:0}',""]),t.exports=e},"64bc":function(t,e,i){"use strict";i("6a54"),Object.defineProperty(e,"__esModule",{value:!0}),e.formatDate=function(t){t=t||Date.now();var e=new Date(t),i=e.getMonth()<9?"0"+(e.getMonth()+1):e.getMonth()+1;return i+="-",i+=e.getDate()<10?"0"+e.getDate():e.getDate(),i+=" ",i+=e.getHours(),i+=":",i+=e.getMinutes()<10?"0"+e.getMinutes():e.getMinutes(),i},e.formateTime=function(t){var e=(new Date).getTime(),i=e-t,a=i/1e3,n=i/6e4,o=i/36e5,s=i/864e5;return s>=1?parseInt(s)+"天":o>=1?parseInt(o)+"小时":n>=1?parseInt(n)+"分钟":a>=1?parseInt(a)+"秒":"0秒"},i("e966")},"6bd8":function(t,e,i){"use strict";(function(t){i("6a54");var a=i("f5bd").default;Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0,i("dd2b"),i("5ef2"),i("aa9c"),i("926e");i("bf47");var n=i("292f"),o=a(i("6e2f")),s=i("10ac"),r=(i("afaf"),i("64bc")),c={data:function(){return{record:{agreeCollectionCount:0,addFollowCount:0,noreplyCount:0},triggered:!1,unreadTotal:0,conversations:[],actionPopup:{conversation:null,visible:!1},currentUser:null,count:-1,actions:[{name:"收藏",width:70,fontsize:30,color:"#fff",background:"#C8C7CD"},{name:"删除",color:"#fff",fontsize:30,width:70,background:"#FD3B31"}],topList:[]}},watch:{record:{handler:function(t,e){t.agreeCollectionCount>0||t.addFollowCount>0||t.noreplyCount>0||this.count>0?uni.showTabBarRedDot({index:2}):uni.hideTabBarRedDot({index:2})}}},onShow:function(){this.createWs(),this.getUserRecord(),this.currentUser=uni.getStorageSync("userInfo"),getApp().globalData.currentUser=this.currentUser,"disconnected"===this.goEasy.getConnectionStatus()&&this.connectGoEasy(),this.goEasy.im.on(this.GoEasy.IM_EVENT.CONVERSATIONS_UPDATED,this.renderConversations),this.loadConversations()},beforeDestroy:function(){this.goEasy.im.off(this.GoEasy.IM_EVENT.CONVERSATIONS_UPDATED,this.renderConversations)},methods:{formatDate:r.formatDate,connectGoEasy:function(){uni.showLoading(),this.goEasy.connect({id:this.currentUser.id,data:{name:this.currentUser.username,avatar:this.currentUser.avatar},onSuccess:function(){t.log("GoEasy connect successfully.")},onFailed:function(e){t.log("Failed to connect GoEasy, code:"+e.code+",error:"+e.content)},onProgress:function(e){t.log("GoEasy is connecting",e)}})},loadConversations:function(){var e=this;this.goEasy.im.latestConversations({onSuccess:function(t){uni.hideLoading();var i=t.content;e.renderConversations(i),e.count=i.unreadTotal},onFailed:function(e){uni.hideLoading(),t.log("获取最新会话列表失败, error:",e)}})},renderConversations:function(t){this.conversations=t.conversations},customBtn:function(e,i){var a=this,n=this;if(0==e){var o=i.top?"取消置顶":"置顶";this.goEasy.im.topConversation({conversation:i,top:!i.top,onSuccess:function(){uni.showToast({title:o+"成功",icon:"none"}),i.top?n.topList.splice(n.topList.indexOf(i.userId),1):n.topList.push(i.userId)},onFailed:function(e){t.log(o,"失败：",e)}})}else uni.showModal({content:"确认删除这条会话吗？",success:function(e){e.confirm&&a.goEasy.im.removeConversation({conversation:i,onSuccess:function(){t.log("删除会话成功")},onFailed:function(e){t.log(e)}})}})},topConversation:function(){var e=this.actionPopup.conversation,i=e.top?"取消置顶":"置顶";this.goEasy.im.topConversation({conversation:e,top:!e.top,onSuccess:function(){uni.showToast({title:i+"成功",icon:"none"})},onFailed:function(e){t.log(i,"失败：",e)}})},deleteConversation:function(){var e=this;uni.showModal({content:"确认删除这条会话吗？",success:function(i){if(i.confirm){var a=e.actionPopup.conversation;e.actionPopup.visible=!1,e.goEasy.im.removeConversation({conversation:a,onSuccess:function(){t.log("删除会话成功")},onFailed:function(e){t.log(e)}})}else e.actionPopup.visible=!1}})},chat:function(t){var e="/pages/message/privateChat/privateChat?to="+t.userId;uni.navigateTo({url:e})},onRefresh:function(){var t=this;this.createWs(),this.triggered=!0,setTimeout((function(){t.triggered=!1}),300),this.getUserRecord(),this.loadConversations()},next:function(t){var e=this;1==t?uni.navigateTo({url:"/pages/message/message-agrees/message-agrees"}):2==t?uni.navigateTo({url:"/pages/message/message-followers/message-followers"}):uni.navigateTo({url:"/pages/message/message-comments/message-comments"});var i={uid:uni.getStorageSync("userInfo").id,type:t};(0,n.clearUserRecord)(i).then((function(t){e.getUserRecord()}))},getUserRecord:function(){var t=this,e={uid:uni.getStorageSync("userInfo").id};(0,n.getUserRecord)(e).then((function(e){t.record=e.data}))},acceptMessage:function(t){var e=JSON.parse(t);Object.getPrototypeOf(e)!=Array.prototype&&(this.record=e)},createWs:function(){var e=this;o.default.connectSocket({url:"ws://"+s.appConfig.WS_API+uni.getStorageSync("userInfo").id}),o.default.onSocketOpen((function(e){t.log("WebSocket连接已打开！")})),o.default.onSocketError((function(e){t.log("WebSocket连接打开失败，请检查！")})),o.default.onSocketMessage((function(t){e.acceptMessage(t.data)}))}}};e.default=c}).call(this,i("ba7c")["default"])},8244:function(t,e,i){var a=i("0958");a.__esModule&&(a=a.default),"string"===typeof a&&(a=[[t.i,a,""]]),a.locals&&(t.exports=a.locals);var n=i("967d").default;n("589daf2d",a,!0,{sourceMap:!1,shadowMode:!1})},"9ebd":function(t,e,i){"use strict";i.r(e);var a=i("d444"),n=i("f672");for(var o in n)["default"].indexOf(o)<0&&function(t){i.d(e,t,(function(){return n[t]}))}(o);i("d330");var s=i("828b"),r=Object(s["a"])(n["default"],a["b"],a["c"],!1,null,"6d069bc1",null,!1,a["a"],void 0);e["default"]=r.exports},b9e6:function(t,e,i){var a=i("53dc");a.__esModule&&(a=a.default),"string"===typeof a&&(a=[[t.i,a,""]]),a.locals&&(t.exports=a.locals);var n=i("967d").default;n("2fb0ebd2",a,!0,{sourceMap:!1,shadowMode:!1})},d330:function(t,e,i){"use strict";var a=i("b9e6"),n=i.n(a);n.a},d444:function(t,e,i){"use strict";i.d(e,"b",(function(){return a})),i.d(e,"c",(function(){return n})),i.d(e,"a",(function(){}));var a=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("v-uni-view",{staticClass:"tui-navigation-bar",class:{"tui-bar-line":t.opacity>.85&&t.splitLine,"tui-navbar-fixed":t.isFixed,"tui-backdrop__filter":t.backdropFilter&&t.dropDownOpacity>0},style:{height:t.height+"px",backgroundColor:"rgba("+t.background+","+t.opacity+")",opacity:t.dropDownOpacity,zIndex:t.isFixed?t.zIndex:"auto"}},[t.isImmersive?i("v-uni-view",{staticClass:"tui-status-bar",style:{height:t.statusBarHeight+"px"}}):t._e(),t.title&&!t.isCustom?i("v-uni-view",{staticClass:"tui-navigation_bar-title",style:{opacity:t.transparent||t.opacity>=t.maxOpacity?1:t.opacity,color:t.color,paddingTop:t.top-t.statusBarHeight+"px"}},[t._v(t._s(t.title))]):t._e(),t._t("default")],2)},n=[]},d65f:function(t,e,i){"use strict";i.r(e);var a=i("6bd8"),n=i.n(a);for(var o in a)["default"].indexOf(o)<0&&function(t){i.d(e,t,(function(){return a[t]}))}(o);e["default"]=n.a},e938:function(t,e,i){"use strict";i.d(e,"b",(function(){return n})),i.d(e,"c",(function(){return o})),i.d(e,"a",(function(){return a}));var a={tuiNavigationBar:i("9ebd").default,tuiIcon:i("bd7a").default,tuiBadge:i("a6eb").default,tuiSwipeAction:i("25f4").default},n=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("v-uni-view",{staticClass:"content"},[i("tui-navigation-bar",{attrs:{backgroundColor:"#fff",isFixed:!1,isOpacity:!1}},[i("v-uni-view",{staticClass:"nav"},[i("tui-icon",{attrs:{name:"arrowleft",size:"24"}}),i("v-uni-view",[t._v("我的消息")])],1)],1),i("v-uni-scroll-view",{staticClass:"page",attrs:{"scroll-y":!0,"refresher-enabled":"true","refresher-triggered":t.triggered},on:{refresherrefresh:function(e){arguments[0]=e=t.$handleEvent(e),t.onRefresh.apply(void 0,arguments)}}},[i("v-uni-view",{staticClass:"tabs"},[i("v-uni-view",{staticClass:"tabs-body"},[i("v-uni-view",{staticClass:"item ",on:{click:function(e){arguments[0]=e=t.$handleEvent(e),t.next(1)}}},[t.record.agreeCollectionCount>0?i("tui-badge",{staticClass:"tui-badge",attrs:{type:"danger",absolute:!0}},[t._v(t._s(t.record.agreeCollectionCount))]):t._e(),i("v-uni-view",{staticClass:"icon"},[i("tui-icon",{attrs:{name:"like",color:"#f90000"}})],1),i("v-uni-view",{staticClass:"name"},[t._v("赞和收藏")])],1),i("v-uni-view",{staticClass:"item",on:{click:function(e){arguments[0]=e=t.$handleEvent(e),t.next(2)}}},[t.record.addFollowCount>0?i("tui-badge",{staticClass:"tui-badge",attrs:{type:"danger",absolute:!0}},[t._v(t._s(t.record.addFollowCount))]):t._e(),i("v-uni-view",{staticClass:"icon"},[i("tui-icon",{attrs:{name:"people",color:"#00aa00"}})],1),i("v-uni-view",{staticClass:"name"},[t._v("新增关注")])],1),i("v-uni-view",{staticClass:"item",on:{click:function(e){arguments[0]=e=t.$handleEvent(e),t.next(3)}}},[t.record.noreplyCount>0?i("tui-badge",{staticClass:"tui-badge",attrs:{type:"danger",absolute:!0}},[t._v(t._s(t.record.noreplyCount))]):t._e(),i("v-uni-view",{staticClass:"icon"},[i("tui-icon",{attrs:{name:"message",color:"#ffaa00"}})],1),i("v-uni-view",{staticClass:"name"},[t._v("评论和@")])],1)],1)],1),i("v-uni-view",[i("v-uni-view",{staticClass:"container"},[t.conversations.length>0?i("ul",{staticClass:"conversation-list"},t._l(t.conversations,(function(e,a){return i("li",{key:a,staticClass:"conversation-item",attrs:{lineLeft:!1}},[i("tui-swipe-action",{attrs:{operateWidth:140},scopedSlots:t._u([{key:"content",fn:function(){return[i("v-uni-view",{staticClass:"tui-item-box",style:t.topList.includes(e.userId)?{backgroundColor:"#f1f1f1"}:{backgroundColor:"#fff"},on:{click:function(i){arguments[0]=i=t.$handleEvent(i),t.chat(e)}}},[i("v-uni-view",{staticClass:"tui-msg-box"},[i("v-uni-image",{staticClass:"tui-msg-pic",attrs:{src:e.data.avatar,mode:"aspectFill","lazy-load":!0}}),i("v-uni-view",{staticClass:"tui-msg-item"},[i("v-uni-view",{staticClass:"tui-msg-name"},[t._v(t._s(e.data.name))]),e.lastMessage.recalled?i("v-uni-view",{staticClass:"tui-msg-content"},[i("v-uni-text",[t._v(t._s(e.lastMessage.recaller.id===t.currentUser.id?"你":e.lastMessage.recaller.data.name)+"撤回了一条消息")])],1):i("v-uni-view",{staticClass:"tui-msg-content"},[i("v-uni-text",{staticClass:"unread-text"},[t._v(t._s(!1===e.lastMessage.read&&e.lastMessage.senderId===t.currentUser.id?"[未读]":""))]),e.lastMessage.senderId===t.currentUser.id?i("v-uni-text",[t._v("我:")]):i("v-uni-text",[t._v(t._s("group"===e.type?e.lastMessage.senderData.name:e.data.name)+":")]),"text"===e.lastMessage.type?i("v-uni-text",[t._v(t._s(e.lastMessage.payload.text))]):"video"===e.lastMessage.type?i("v-uni-text",[t._v("[视频消息]")]):"audio"===e.lastMessage.type?i("v-uni-text",[t._v("[语音消息]")]):"image"===e.lastMessage.type?i("v-uni-text",[t._v("[图片消息]")]):"file"===e.lastMessage.type?i("v-uni-text",[t._v("[文件消息]")]):"order"===e.lastMessage.type?i("v-uni-text",[t._v("[自定义消息:订单]")]):i("v-uni-text",[t._v("[[未识别内容]]")])],1)],1)],1),i("v-uni-view",{staticClass:"tui-msg-right"},[i("v-uni-view",{staticClass:"tui-msg-time"},[t._v(t._s(t.formatDate(e.lastMessage.timestamp)))]),e.unread>0?i("tui-badge",{staticClass:"tui-badge",attrs:{type:"danger"}},[t._v(t._s(e.unread))]):t._e()],1)],1)]},proxy:!0},{key:"button",fn:function(){return[i("v-uni-view",{staticClass:"tui-custom-btn_box"},[i("v-uni-view",{staticClass:"tui-custom-btn-top",on:{click:function(i){arguments[0]=i=t.$handleEvent(i),t.customBtn(0,e)}}},[t._v(t._s(e.top?"取消置顶":"置顶聊天"))]),i("v-uni-view",{staticClass:"tui-custom-btn-delete",on:{click:function(i){arguments[0]=i=t.$handleEvent(i),t.customBtn(1,e)}}},[t._v("删除")])],1)]},proxy:!0}],null,!0)})],1)})),0):i("v-uni-view",{staticClass:"no-conversation"},[t._v("当前没有会话")])],1)],1)],1)],1)},o=[]},f672:function(t,e,i){"use strict";i.r(e);var a=i("47df"),n=i.n(a);for(var o in a)["default"].indexOf(o)<0&&function(t){i.d(e,t,(function(){return a[t]}))}(o);e["default"]=n.a},fb9b:function(t,e,i){"use strict";var a=i("8244"),n=i.n(a);n.a}}]);