(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["pages-message-message"],{2252:function(t,e,i){"use strict";i.r(e);var a=i("7c8c"),n=i.n(a);for(var s in a)["default"].indexOf(s)<0&&function(t){i.d(e,t,(function(){return a[t]}))}(s);e["default"]=n.a},2350:function(t,e,i){"use strict";i.d(e,"b",(function(){return n})),i.d(e,"c",(function(){return s})),i.d(e,"a",(function(){return a}));var a={tuiNavigationBar:i("9ebd").default,tuiBadge:i("a6eb").default,tuiIcon:i("bd7a").default,tuiListView:i("f34f").default,tuiListCell:i("6841").default,tuiSwipeAction:i("25f4").default},n=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("v-uni-view",{staticClass:"content"},[i("tui-navigation-bar",{attrs:{backgroundColor:"#fff",isFixed:!1,isOpacity:!1}},[i("v-uni-view",{staticClass:"nav"},[i("v-uni-view",[t._v("消息")])],1)],1),i("v-uni-scroll-view",{staticClass:"page",attrs:{"scroll-y":!0,"refresher-enabled":"true","refresher-triggered":t.triggered},on:{refresherrefresh:function(e){arguments[0]=e=t.$handleEvent(e),t.onRefresh.apply(void 0,arguments)}}},[i("v-uni-view",{staticClass:"tabs"},[i("v-uni-view",{staticClass:"tabs-body"},[i("v-uni-view",{staticClass:"item ",on:{click:function(e){arguments[0]=e=t.$handleEvent(e),t.next(1)}}},[t.record.agreeCollectionCount>0?i("tui-badge",{staticClass:"tui-badge",attrs:{type:"danger",absolute:!0}},[t._v(t._s(t.record.agreeCollectionCount))]):t._e(),i("v-uni-view",{staticClass:"icon"},[i("tui-icon",{attrs:{name:"like",color:"#f90000"}})],1),i("v-uni-view",{staticClass:"name"},[t._v("赞和收藏")])],1),i("v-uni-view",{staticClass:"item",on:{click:function(e){arguments[0]=e=t.$handleEvent(e),t.next(2)}}},[t.record.addFollowCount>0?i("tui-badge",{staticClass:"tui-badge",attrs:{type:"danger",absolute:!0}},[t._v(t._s(t.record.addFollowCount))]):t._e(),i("v-uni-view",{staticClass:"icon"},[i("tui-icon",{attrs:{name:"people",color:"#00aa00"}})],1),i("v-uni-view",{staticClass:"name"},[t._v("新增关注")])],1),i("v-uni-view",{staticClass:"item",on:{click:function(e){arguments[0]=e=t.$handleEvent(e),t.next(3)}}},[t.record.noreplyCount>0?i("tui-badge",{staticClass:"tui-badge",attrs:{type:"danger",absolute:!0}},[t._v(t._s(t.record.noreplyCount))]):t._e(),i("v-uni-view",{staticClass:"icon"},[i("tui-icon",{attrs:{name:"message",color:"#ffaa00"}})],1),i("v-uni-view",{staticClass:"name"},[t._v("评论和@")])],1)],1)],1),i("v-uni-view",[i("v-uni-view",{staticClass:"container"},[i("tui-list-view",t._l(t.dataList,(function(e,a){return i("tui-list-cell",{key:a,attrs:{lineLeft:!1}},[i("tui-swipe-action",{attrs:{actions:t.actions},on:{click:function(i){arguments[0]=i=t.$handleEvent(i),t.handleAction(e,a)}},scopedSlots:t._u([{key:"content",fn:function(){return[i("v-uni-view",{staticClass:"tui-item-box",on:{click:function(i){arguments[0]=i=t.$handleEvent(i),t.chat(e.uid,a)}}},[i("v-uni-view",{staticClass:"tui-msg-box"},[i("v-uni-image",{staticClass:"tui-msg-pic",attrs:{src:e.avatar,mode:"aspectFill","lazy-load":!0}}),i("v-uni-view",{staticClass:"tui-msg-item"},[i("v-uni-view",{staticClass:"tui-msg-name"},[t._v(t._s(e.username))]),i("v-uni-view",{staticClass:"tui-msg-content"},[t._v(t._s(e.content))])],1)],1),i("v-uni-view",{staticClass:"tui-msg-right"},[i("v-uni-view",{staticClass:"tui-msg-time"},[t._v(t._s(e.time))]),e.count>0?i("tui-badge",{staticClass:"tui-badge",attrs:{type:"danger"}},[t._v(t._s(e.count))]):t._e()],1)],1)]},proxy:!0}],null,!0)})],1)})),1)],1)],1)],1)],1)},s=[]},"4f92":function(t,e,i){"use strict";var a=i("a0fb"),n=i.n(a);n.a},"7c8c":function(t,e,i){"use strict";(function(t){i("6a54");var a=i("f5bd").default;Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0,i("dd2b"),i("bf0f"),i("2797"),i("aa9c"),i("926e");var n=i("bf47"),s=i("292f"),o=a(i("6e2f")),c=i("10ac"),r=i("afaf"),u={data:function(){return{dataList:[],actions:[{name:"删除",color:"#fff",fontsize:30,width:70,background:"#FD3B31"}],record:{agreeCollectionCount:0,addFollowCount:0,noreplyCount:0},messageCount:0,triggered:!1}},computed:{},watch:{record:{handler:function(t,e){t.agreeCollectionCount>0||t.addFollowCount>0||t.noreplyCount>0||this.messageCount>0?uni.showTabBarRedDot({index:2}):uni.hideTabBarRedDot({index:2})}},messageCount:{handler:function(t,e){this.record.agreeCollectionCount>0||this.record.addFollowCount>0||this.record.noreplyCount>0||t>0?uni.showTabBarRedDot({index:2}):uni.hideTabBarRedDot({index:2})},immediate:!0}},onShow:function(){this.dataList=[],this.createWs(),this.getChatUserList(),this.getUserRecord()},methods:{onRefresh:function(){var t=this;this.createWs(),this.triggered=!0,setTimeout((function(){t.triggered=!1}),300),this.dataList=[],this.getUserRecord(),this.getChatUserList()},next:function(t){var e=this;1==t?uni.navigateTo({url:"/pages/message/message-agrees/message-agrees"}):2==t?uni.navigateTo({url:"/pages/message/message-followers/message-followers"}):uni.navigateTo({url:"/pages/message/message-comments/message-comments"});var i={uid:uni.getStorageSync("userInfo").id,type:t};(0,s.clearUserRecord)(i).then((function(t){e.getUserRecord()}))},handleAction:function(t,e){var i=this,a={sendId:t.sendId,acceptId:uni.getStorageSync("userInfo").id};(0,n.deleteRecord)(a).then((function(t){i.messageCount=i.messageCount-i.dataList[e].count,i.dataList.splice(e,1)}))},getChatUserList:function(){var t=this,e={uid:uni.getStorageSync("userInfo").id};(0,n.getChatUserList)(e).then((function(e){e.data.forEach((function(e){e.time=(0,r.timeAgo)(e.timestamp),t.dataList.push(e)})),e.data.forEach((function(e){e.count>0&&(t.messageCount+=e.count)}))}))},getUserRecord:function(){var t=this,e={uid:uni.getStorageSync("userInfo").id};(0,s.getUserRecord)(e).then((function(e){t.record=e.data}))},chat:function(t,e){var i=this,a={sendId:t,acceptId:uni.getStorageSync("userInfo").id};(0,n.updateRecordCount)(a).then((function(a){i.messageCount=i.messageCount-i.dataList[e].count,i.dataList[e].count=0,uni.navigateTo({url:"/pages/chat/chat2?toUid="+t})}))},acceptMessage:function(t){var e=JSON.parse(t);if(Object.getPrototypeOf(e)!=Array.prototype)this.record=e;else{this.dataList=e;var i=0;e.forEach((function(t){t.count>0&&(i+=t.count)})),this.messageCount=i}},createWs:function(){var e=this;o.default.connectSocket({url:"ws://"+c.appConfig.WS_API+uni.getStorageSync("userInfo").id}),o.default.onSocketOpen((function(e){t.log("WebSocket连接已打开！")})),o.default.onSocketError((function(e){t.log("WebSocket连接打开失败，请检查！")})),o.default.onSocketMessage((function(t){e.acceptMessage(t.data)}))}}};e.default=u}).call(this,i("ba7c")["default"])},a0fb:function(t,e,i){var a=i("e3fc");a.__esModule&&(a=a.default),"string"===typeof a&&(a=[[t.i,a,""]]),a.locals&&(t.exports=a.locals);var n=i("967d").default;n("10dfa637",a,!0,{sourceMap:!1,shadowMode:!1})},bf8c:function(t,e,i){"use strict";i.r(e);var a=i("2350"),n=i("2252");for(var s in n)["default"].indexOf(s)<0&&function(t){i.d(e,t,(function(){return n[t]}))}(s);i("4f92");var o=i("828b"),c=Object(o["a"])(n["default"],a["b"],a["c"],!1,null,"df9e318c",null,!1,a["a"],void 0);e["default"]=c.exports},e3fc:function(t,e,i){var a=i("c86c");e=a(!1),e.push([t.i,"[data-v-df9e318c] .uni-scroll-view-refresh__spinner>circle{color:#8c8c8c!important}[data-v-df9e318c] .uni-scroll-view-refresh-inner>svg{fill:#8c8c8c!important}[data-v-df9e318c] .uni-scroll-view-refresh-inner{box-shadow:0 0 0 #fff}.content .nav[data-v-df9e318c]{margin-top:%?12?%;display:flex;align-items:center;justify-content:center; /* 水平居中 */font-weight:700 /* 加粗 */}.page[data-v-df9e318c]{height:95vh}.tabs[data-v-df9e318c]{height:%?120?%}.tabs-body[data-v-df9e318c]{width:%?600?%;margin:auto;display:flex;justify-content:space-between;align-items:center}.tabs-body .item[data-v-df9e318c]{position:relative;text-align:center}.tabs-body .item .name[data-v-df9e318c]{font-size:%?28?%}.container[data-v-df9e318c]{padding-bottom:env(safe-area-inset-bottom)}.tui-item-box[data-v-df9e318c]{width:100%;display:flex;align-items:center}.tui-msg-box[data-v-df9e318c]{display:flex;align-items:center}.tui-msg-pic[data-v-df9e318c]{width:%?100?%;height:%?100?%;border-radius:50%;display:block;margin-right:%?24?%;flex-shrink:0}.tui-msg-item[data-v-df9e318c]{max-width:%?500?%;min-height:%?80?%;overflow:hidden;display:flex;flex-direction:column;justify-content:space-between}.tui-msg-name[data-v-df9e318c]{overflow:hidden;white-space:nowrap;text-overflow:ellipsis;font-size:%?30?%;line-height:1;color:#262b3a}.tui-msg-content[data-v-df9e318c]{overflow:hidden;white-space:nowrap;text-overflow:ellipsis;font-size:%?25?%;line-height:1;color:#9397a4}.tui-msg-right[data-v-df9e318c]{max-width:%?180?%;height:%?88?%;margin-left:auto;text-align:right;display:flex;flex-direction:column;justify-content:space-between;align-items:flex-end}.tui-right-dot[data-v-df9e318c]{height:%?76?%!important;padding-bottom:%?10?%!important}.tui-msg-time[data-v-df9e318c]{width:100%;font-size:%?24?%;line-height:%?24?%;color:#9397a4}",""]),t.exports=e}}]);