(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["pages-chat-chat2"],{"395e":function(e,t,n){var a=n("c86c");t=a(!1),t.push([e.i,".container[data-v-edb90f02]{width:100vw;height:100vh;box-sizing:border-box;padding-bottom:%?175?%;display:flex;flex-direction:column}.container .header[data-v-edb90f02]{flex-shrink:0;padding:0 %?40?% %?60?% %?40?%}.container .header .nav[data-v-edb90f02]{display:flex;justify-content:space-between;margin-right:10px}.container .content[data-v-edb90f02]{margin-top:52px;flex-grow:1;overflow:auto;height:90vh}.container .content .message[data-v-edb90f02]{margin:0 %?40?% %?32?%;display:flex;flex-direction:column;align-items:flex-end}.container .content .message .message-content[data-v-edb90f02]{width:auto;max-width:calc(100vw - %?80?%);word-wrap:break-word;box-sizing:border-box;padding:%?32?%;line-height:%?48?%;background:pink;border-radius:%?16?% 0 %?16?% %?16?%}.container .content .message .message-time[data-v-edb90f02]{line-height:%?32?%;margin-top:%?16?%}.container .content .tui-flex-end[data-v-edb90f02]{justify-content:flex-end}.container .content .tui-chat-item[data-v-edb90f02]{width:100%;padding:%?30?% %?30?% 0 %?30?%;box-sizing:border-box;display:flex;position:relative}.container .content .tui-chat-item .tui-chat-box[data-v-edb90f02]{max-width:70%}.container .content .tui-chat-item .tui-chat-box .tui-user-name[data-v-edb90f02]{font-size:%?24?%;color:#999}.container .content .tui-chat-item .tui-chat-box .tui-chat-text[data-v-edb90f02]{width:100%;min-width:%?40?%;padding:%?18?% %?24?%;display:flex;align-items:center;flex-wrap:wrap;word-break:break-all;box-sizing:border-box}.container .content .tui-chat-item .tui-user-avatar[data-v-edb90f02]{width:%?84?%;height:%?84?%;border-radius:50%;flex-shrink:0}.container .content .tui-chat-item .tui-mr[data-v-edb90f02]{margin-right:%?24?%}.container .content .tui-chat-item .tui-ml[data-v-edb90f02]{margin-left:%?24?%}.bottom-textarea[data-v-edb90f02]{position:fixed;bottom:0;left:0;right:0;background-color:#fff;border-top:%?1?% solid #f4f4f4;padding:6px 20px;display:flex;align-items:flex-end}.bottom-textarea .textarea-container[data-v-edb90f02]{flex:1;min-height:%?60?%;background:#f2f2f2;border-radius:%?8?%;box-sizing:border-box;padding:%?20?% %?16?%}.bottom-textarea .textarea-container > uni-textarea[data-v-edb90f02]{max-height:%?250?%;font-size:%?36?%;color:#080808;width:auto}.avatar[data-v-edb90f02]{width:%?60?%;height:%?60?%;border-radius:50%;margin-top:5px;margin-left:142px}.username[data-v-edb90f02]{margin-top:10px;width:%?60?%;height:%?30?%;margin-right:140px}.left-chat-time[data-v-edb90f02]{font-size:%?24?%;color:#999}.right-chat-time[data-v-edb90f02]{text-align:right;font-size:%?24?%;color:#999}",""]),e.exports=t},"6e2f":function(e,t,n){(function(e){var a=n("bdbb").default;n("6a54"),n("01a2"),n("e39c"),n("bf0f"),n("4e9b"),n("114e"),n("c240"),n("844d"),n("18f7"),n("de6c"),n("5c47"),n("2c10"),n("9e15"),n("884b"),n("7a76"),n("c9b5"),n("64aa"),n("ab80"),n("c223"),n("d4b5"),n("5ef2"),n("2797"),n("aa9c"),n("dd2b"),n("4db2"),n("c976"),n("4d8f"),n("7b97"),n("668a"),n("c5b7"),n("8ff5"),n("2378"),n("641a"),n("64e0"),n("cce3"),n("efba"),n("d009"),n("bd7d"),n("7edd"),n("d798"),n("f547"),n("5e54"),n("b60a"),n("8c18"),n("12973"),n("f991"),n("198e"),n("8557"),n("63b1"),n("1954"),n("1cf1"),n("80e3"),function(e,t){for(var n in t)e[n]=t[n]}(t,function(e){var t={};function n(a){if(t[a])return t[a].exports;var o=t[a]={i:a,l:!1,exports:{}};return e[a].call(o.exports,o,o.exports,n),o.l=!0,o.exports}return n.m=e,n.c=t,n.d=function(e,t,a){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:a})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==a(e)&&e&&e.__esModule)return e;var o=Object.create(null);if(n.r(o),Object.defineProperty(o,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var r in e)n.d(o,r,function(t){return e[t]}.bind(null,r));return o},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=1)}([function(t,n,o){"use strict";function r(e){return(r="function"==typeof Symbol&&"symbol"==a(Symbol.iterator)?function(e){return a(e)}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":a(e)})(e)}function i(t,n,a){n?n.errMsg||(n.errMsg="callback:ok"):"object"===r(a)?(a||(a={errMsg:"callback:fail"}),a.errMsg||(a.errMsg=a.message||"callback:fail")):a={errMsg:"callback:fail "+String(a)},t&&"function"==typeof t.success&&n&&t.success(n),a&&e.warn("Callback Fail:",a),t&&"function"==typeof t.fail&&a&&t.fail(a),t&&"function"==typeof t.complete&&t.complete(n||a)}Object.defineProperty(n,"__esModule",{value:!0}),n.getCallback=n.callback=n.plusReady=n.isApp=n.isWeex=n.isWeb=n.isPlus=void 0,n.isPlus="object"===("undefined"==typeof navigator?"undefined":r(navigator))&&!!navigator.userAgent.match(/Html5Plus/i),n.isWeb="object"===("undefined"==typeof document?"undefined":r(document))&&!n.isPlus,n.isWeex="object"===("undefined"==typeof weex?"undefined":r(weex)),n.isApp=n.isPlus||n.isWeex,n.plusReady=function(e){"object"===("undefined"==typeof plus?"undefined":r(plus))?e():n.isApp&&window.addEventListener("plusready",e,!1)},n.callback=i,n.getCallback=function(){return i}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=n(2);Object.defineProperty(t,"connectSocket",{enumerable:!0,get:function(){return a.connectSocket}}),Object.defineProperty(t,"onSocketOpen",{enumerable:!0,get:function(){return a.onSocketOpen}}),Object.defineProperty(t,"onSocketError",{enumerable:!0,get:function(){return a.onSocketError}}),Object.defineProperty(t,"sendSocketMessage",{enumerable:!0,get:function(){return a.sendSocketMessage}}),Object.defineProperty(t,"onSocketMessage",{enumerable:!0,get:function(){return a.onSocketMessage}}),Object.defineProperty(t,"closeSocket",{enumerable:!0,get:function(){return a.closeSocket}}),Object.defineProperty(t,"onSocketClose",{enumerable:!0,get:function(){return a.onSocketClose}})},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.onSocketClose=t.closeSocket=t.onSocketMessage=t.sendSocketMessage=t.onSocketError=t.onSocketOpen=t.connectSocket=void 0;var a=n(3),o=null,r={};function i(e,t){o?o[e](t):r[e]=t}t.connectSocket=function(e){e=e||{};var t=new a.SocketTask(e);function n(){o=null}if(t.onClose(n),t.onError(n),!o)for(var i in o=t,r)r.hasOwnProperty(i)&&t[i](r[i]);return o=o||t,t},t.onSocketOpen=function(e){i("onOpen",e)},t.onSocketError=function(e){i("onError",e)},t.sendSocketMessage=function(e){o&&o.send(e)},t.onSocketMessage=function(e){i("onMessage",e)},t.closeSocket=function(e){o&&o.close(e)},t.onSocketClose=function(e){i("onClose",e)}},function(e,t,n){"use strict";function o(e){return(o="function"==typeof Symbol&&"symbol"==a(Symbol.iterator)?function(e){return a(e)}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":a(e)})(e)}function r(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,(r=a.key,void 0,i=function(e,t){if("object"!==o(e)||null===e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var a=n.call(e,t);if("object"!==o(a))return a;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(r,"string"),"symbol"===o(i)?i:String(i)),a)}var r,i}var i=this&&this.__createBinding||(Object.create?function(e,t,n,a){void 0===a&&(a=n),Object.defineProperty(e,a,{enumerable:!0,get:function(){return t[n]}})}:function(e,t,n,a){void 0===a&&(a=n),e[a]=t[n]}),c=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),s=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)"default"!==n&&Object.hasOwnProperty.call(e,n)&&i(t,e,n);return c(t,e),t},u=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.SocketTask=void 0;var d,l,f=s(n(4)),b=n(0),p=u(n(5)),h={},v=n(6),g=!1,m=[],y=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.id=Date.now().toString(),this.eval("connect",t)}var t,a;return t=e,(a=[{key:"send",value:function(e){e.data&&"string"!=typeof e.data&&(e.data=[p.default.encode(e.data)]),this.eval("send",e)}},{key:"close",value:function(e){this.eval("close",e)}},{key:"onOpen",value:function(e){this.on("open",e)}},{key:"onClose",value:function(e){this.on("close",e)}},{key:"onError",value:function(e){this.on("error",e)}},{key:"onMessage",value:function(e){this.on("message",(function(t){t=(t=t.data)&&"string"!=typeof t?p.default.decode(t[0]):t,e({data:t})}))}},{key:"eval",value:function(e,t){var a="callback".concat(Date.now()),o=b.isWeb?window:h;o[a]=function(e){delete o[a],e?b.callback(t,{},e):b.callback(t,{})};var r="window.__webSocket&&__webSocket.".concat(e,"(").concat(this.id,",").concat(JSON.stringify(t),",'").concat(a,"')");b.isWeb?(d||(window.eval(v),d=!0),window.eval(r)):b.plusReady((function(){!function(e){var t=plus.webview.getWebviewById("__websocket__");if(!t){var a=n(7);(t=plus.webview.create("http://www.dcloud.io","__websocket__",{kernel:"WKWebview",render:"always",plusrequire:"none"})).overrideUrlLoading({match:".*data.*"},(function(e){var n=e.url,a=n.match(/\?(\S+)=(\S+)/);if(a){var o=a[1],r=JSON.parse(decodeURIComponent(a[2]));"event"===o?f.emit(r.type,r.data):"callback"===o&&h[r.callbackName](r.error)}else!g&&"number"!=typeof l&&n.indexOf("load")>=0?l=setInterval((function(){t.evalJS(v)}),16):!g&&n.indexOf("ready")>=0&&(clearInterval(l),g=!0,m.forEach((function(e){e(t)})),m=[])})),t.loadData(a,{baseURL:"http://websocket.websocket"})}g?e(t):m.push(e)}((function(e){e.evalJS(r)}))}))}},{key:"on",value:function(e,t){f.on("websocket".concat(e).concat(this.id),(function(e){t(e.detail)}))}}])&&r(t.prototype,a),Object.defineProperty(t,"prototype",{writable:!1}),e}();t.SocketTask=y},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.emit=t.off=t.on=void 0;var a=n(0),o={};t.on=function(e,t){a.isWeb?window.addEventListener(e,t,!1):(o[e]=o[e]||[],o[e].push(t))},t.off=function(e,t){if(a.isWeb)window.removeEventListener(e,t,!1);else{var n=o[e];n&&n.splice(n.indexOf(t),1)}},t.emit=function(e,t){if(a.isWeb)document.dispatchEvent(new CustomEvent(e,{detail:t,bubbles:!0}));else{var n=o[e];n&&n.forEach((function(e){e({detail:t})}))}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a={chars:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",lookup:null,encode:function(e){var t,n=this.chars,a=new Uint8Array(e),o=a.length,r="";for(t=0;t<o;t+=3)r+=n[a[t]>>2],r+=n[(3&a[t])<<4|a[t+1]>>4],r+=n[(15&a[t+1])<<2|a[t+2]>>6],r+=n[63&a[t+2]];return o%3==2?r=r.substring(0,r.length-1)+"=":o%3==1&&(r=r.substring(0,r.length-2)+"=="),r},decode:function(e){var t=this.chars,n=this.lookup;if(!n){n=this.lookup=new Uint8Array(256);for(var a=0;a<t.length;a++)n[t.charCodeAt(a)]=a}var o,r,i,c,s=.75*e.length,u=e.length,d=0;"="===e[e.length-1]&&(s--,"="===e[e.length-2]&&s--);var l=new ArrayBuffer(s),f=new Uint8Array(l);for(a=0;a<u;a+=4)o=n[e.charCodeAt(a)],r=n[e.charCodeAt(a+1)],i=n[e.charCodeAt(a+2)],c=n[e.charCodeAt(a+3)],f[d++]=o<<2|r>>4,f[d++]=(15&r)<<4|i>>2,f[d++]=(3&i)<<6|63&c;return l}};t.default=a},function(e,t){e.exports="(function () {\n    if (window.__webSocket) {\n        return\n    }\n    var isPlus = typeof navigator === 'object' && !!navigator.userAgent.match(/Html5Plus/i)\n    if (isPlus) {\n        location.href = 'http://data?ready'\n    }\n    // 自定义事件\n    var $event = {\n        emit (type, data) {\n            if (!isPlus) {\n                document.dispatchEvent(new CustomEvent(type, {\n                    detail: data,\n                    bubbles: true\n                }))\n                return\n            }\n            location.href = 'http://data?event=' + encodeURIComponent(JSON.stringify({\n                type,\n                data\n            }))\n        }\n    }\n    var Base64 = {\n        chars: \"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/\",\n        lookup: null,\n        encode: function (arraybuffer) {\n            var chars = this.chars;\n            var bytes = new Uint8Array(arraybuffer),\n                i, len = bytes.length, base64 = \"\";\n\n            for (i = 0; i < len; i += 3) {\n                base64 += chars[bytes[i] >> 2];\n                base64 += chars[((bytes[i] & 3) << 4) | (bytes[i + 1] >> 4)];\n                base64 += chars[((bytes[i + 1] & 15) << 2) | (bytes[i + 2] >> 6)];\n                base64 += chars[bytes[i + 2] & 63];\n            }\n\n            if ((len % 3) === 2) {\n                base64 = base64.substring(0, base64.length - 1) + \"=\";\n            } else if (len % 3 === 1) {\n                base64 = base64.substring(0, base64.length - 2) + \"==\";\n            }\n\n            return base64;\n        },\n        decode: function (base64) {\n            var chars = this.chars;\n            var lookup = this.lookup\n            if (!lookup) {\n                lookup = this.lookup = new Uint8Array(256);\n                for (var i = 0; i < chars.length; i++) {\n                    lookup[chars.charCodeAt(i)] = i;\n                }\n            }\n            var bufferLength = base64.length * 0.75,\n                len = base64.length, p = 0,\n                encoded1, encoded2, encoded3, encoded4;\n\n            if (base64[base64.length - 1] === \"=\") {\n                bufferLength--;\n                if (base64[base64.length - 2] === \"=\") {\n                    bufferLength--;\n                }\n            }\n\n            var arraybuffer = new ArrayBuffer(bufferLength),\n                bytes = new Uint8Array(arraybuffer);\n\n            for (i = 0; i < len; i += 4) {\n                encoded1 = lookup[base64.charCodeAt(i)];\n                encoded2 = lookup[base64.charCodeAt(i + 1)];\n                encoded3 = lookup[base64.charCodeAt(i + 2)];\n                encoded4 = lookup[base64.charCodeAt(i + 3)];\n\n                bytes[p++] = (encoded1 << 2) | (encoded2 >> 4);\n                bytes[p++] = ((encoded2 & 15) << 4) | (encoded3 >> 2);\n                bytes[p++] = ((encoded3 & 3) << 6) | (encoded4 & 63);\n            }\n\n            return arraybuffer;\n        }\n    }\n\n    window.__webSocket = {\n        webSockets: {},\n        connect (id, data, callbackName) {\n            var url = data.url\n            var header = data.header// 未支持\n            var method = data.method// 未支持\n            var protocols = data.protocols || []\n            var webSocket\n            try {\n                webSocket = this.webSockets[id] = new WebSocket(url, protocols)\n                webSocket.binaryType = 'arraybuffer'\n            } catch (error) {\n                this.callback(callbackName, error)\n                return\n            }\n            this.callback(callbackName)\n            if (webSocket) {\n                webSocket.addEventListener('open', () => {\n                    $event.emit(`websocketopen${id}`, {})\n                })\n                webSocket.addEventListener('message', ({ data }) => {\n                    $event.emit(`websocketmessage${id}`, {\n                        data: data && typeof data !== 'string' ? [Base64.encode(data)] : data\n                    })\n                })\n                webSocket.addEventListener('error', () => {\n                    $event.emit(`websocketerror${id}`, {})\n                })\n                webSocket.addEventListener('close', (event) => {\n                    $event.emit(`websocketclose${id}`, {\n                        code: event.code,\n                        reason: event.reason\n                    })\n                })\n            }\n        },\n        send (id, data = {}, callbackName) {\n            data = data.data\n            data = data && typeof data !== 'string' ? Base64.decode(data[0]) : data\n            try {\n                this.webSockets[id].send(data)\n            } catch (error) {\n                this.callback(callbackName, error)\n                return\n            }\n            this.callback(callbackName)\n        },\n        close (id, data = {}, callbackName) {\n            var options = []\n            options.push(data.code || 1000)\n            if (typeof data.reason === 'string') {\n                options.push(data.reason)\n            }\n            try {\n                this.webSockets[id].close(...options)\n            } catch (error) {\n                this.callback(callbackName, error)\n                return\n            }\n            this.callback(callbackName)\n        },\n        callback (callbackName, error) {\n            if (isPlus) {\n                location.href = 'http://data?callback=' + encodeURIComponent(JSON.stringify({\n                    callbackName,\n                    error\n                }))\n            } else {\n                var js = `window.${callbackName}&&window.${callbackName}('${error || ''}')`\n                window[callbackName] && window[callbackName](error | '')\n                window.eval(js)\n            }\n        }\n    }\n})()"},function(e,t){e.exports='<!doctype html> <html lang=en> <head> <meta charset=UTF-8> <title>WebSocket</title> </head> <body> <script>location.href="http://data/load"<\/script> </body> </html>'}]))}).call(this,n("ba7c")["default"])},"6ea6":function(e,t,n){"use strict";var a=n("d343"),o=n.n(a);o.a},"73e1":function(e,t,n){"use strict";var a=n("29d8");e.exports=/Version\/10(?:\.\d+){1,2}(?: [\w./]+)?(?: Mobile\/\w+)? Safari\//.test(a)},"795c":function(e,t,n){"use strict";var a=n("8bdb"),o=n("db04").start,r=n("73e1");a({target:"String",proto:!0,forced:r},{padStart:function(e){return o(this,e,arguments.length>1?arguments[1]:void 0)}})},"9e13":function(e,t,n){"use strict";n.d(t,"b",(function(){return o})),n.d(t,"c",(function(){return r})),n.d(t,"a",(function(){return a}));var a={tuiNavigationBar:n("9ebd").default,tuiIcon:n("bd7a").default,tuiBubblePopup:n("d3de").default,tuiButton:n("e718").default},o=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("v-uni-view",[n("v-uni-view",{staticClass:"container",style:{"padding-bottom":175+e.inputBottom+"rpx"}},[n("v-uni-view",{staticClass:"header"},[n("tui-navigation-bar",{attrs:{backgroundColor:"#fff",isFixed:!0,isOpacity:!1}},[n("v-uni-view",{staticClass:"nav"},[n("tui-icon",{attrs:{name:"arrowleft",size:"25"},on:{click:function(t){arguments[0]=t=e.$handleEvent(t),e.back.apply(void 0,arguments)}}}),n("v-uni-view",{on:{click:function(t){arguments[0]=t=e.$handleEvent(t),e.getUserInfo(e.toUserInfo.id)}}},[n("v-uni-image",{staticClass:"avatar",attrs:{src:e.toUserInfo.avatar,mode:"aspectFill"}})],1),n("v-uni-view",{staticClass:"username"},[e._v(e._s(e.toUserInfo.username))]),n("tui-icon",{attrs:{name:"more-fill",size:"22"}})],1)],1)],1),n("v-uni-scroll-view",{staticClass:"content",attrs:{"scroll-y":!0,"scroll-top":e.scrollTop,"refresher-enabled":"true","refresher-triggered":e.triggered},on:{refresherrefresh:function(t){arguments[0]=t=e.$handleEvent(t),e.onRefresh.apply(void 0,arguments)}}},e._l(e.dataList,(function(t,a){return n("v-uni-view",{attrs:{id:"chatBox"}},[t.sendUid!=e.userInfo.id?n("v-uni-view",{staticClass:"tui-chat-item"},[n("v-uni-image",{staticClass:"tui-user-avatar tui-mr",attrs:{src:e.toUserInfo.avatar,mode:"aspectFill"},on:{click:function(t){arguments[0]=t=e.$handleEvent(t),e.getUserInfo(e.toUserInfo.id)}}}),n("v-uni-view",{staticClass:"tui-chat-box"},[n("v-uni-view",{staticClass:"left-chat-time"},[e._v(e._s(t.time))]),n("tui-bubble-popup",{attrs:{direction:"left",position:"relative",mask:!1,show:!0,triangleLeft:"-22rpx",triangleTop:"30rpx",width:"100%",backgroundColor:"#ff7900"}},[n("v-uni-view",{staticClass:"tui-chat-text"},[e._v(e._s(t.content))])],1)],1)],1):n("v-uni-view",{staticClass:"tui-chat-item tui-flex-end"},[n("v-uni-view",{staticClass:"tui-chat-box"},[n("v-uni-view",{staticClass:"right-chat-time"},[e._v(e._s(t.time))]),n("tui-bubble-popup",{attrs:{direction:"right",position:"relative",mask:!1,show:!0,triangleRight:"-22rpx",triangleTop:"30rpx",width:"100%",flexEnd:!0,backgroundColor:"#19be6b"}},[n("v-uni-view",{staticClass:"tui-chat-text"},[e._v(e._s(t.content))])],1)],1),n("v-uni-image",{staticClass:"tui-user-avatar tui-ml",attrs:{src:e.userInfo.avatar,mode:"aspectFill"},on:{click:function(t){arguments[0]=t=e.$handleEvent(t),e.getUserInfo(e.userInfo.id)}}})],1)],1)})),1)],1),n("v-uni-view",{staticClass:"bottom-textarea",style:{bottom:e.inputBottom+"px"}},[n("v-uni-view",{staticClass:"textarea-container"},[n("v-uni-textarea",{attrs:{maxlength:-1,"auto-height":!0,"show-confirm-bar":!1,"cursor-spacing":10,fixed:!0,"adjust-position":!1},on:{focus:function(t){arguments[0]=t=e.$handleEvent(t),e.focusTextarea.apply(void 0,arguments)},blur:function(t){arguments[0]=t=e.$handleEvent(t),e.blurTextarea.apply(void 0,arguments)}},model:{value:e.recordInput,callback:function(t){e.recordInput=t},expression:"recordInput"}})],1),n("tui-button",{attrs:{type:"danger",height:"82rpx",width:"100rpx"},on:{click:function(t){arguments[0]=t=e.$handleEvent(t),e.send()}}},[e._v("发送")])],1)],1)},r=[]},a2ae:function(e,t,n){"use strict";n.r(t);var a=n("eae5"),o=n.n(a);for(var r in a)["default"].indexOf(r)<0&&function(e){n.d(t,e,(function(){return a[e]}))}(r);t["default"]=o.a},afaf:function(e,t,n){"use strict";function a(e,t){var n,a={"Y+":t.getFullYear().toString(),"m+":(t.getMonth()+1).toString(),"d+":t.getDate().toString(),"H+":t.getHours().toString(),"M+":t.getMinutes().toString(),"S+":t.getSeconds().toString()};for(var o in a)n=new RegExp("("+o+")").exec(e),n&&(e=e.replace(n[1],1==n[1].length?a[o]:a[o].padStart(n[1].length,"0")));return e}n("6a54"),Object.defineProperty(t,"__esModule",{value:!0}),t.IsURL=function(e){var t=new RegExp("^((https|http|ftp|rtsp|mms)?://)?(([0-9a-zA-Z_!~*'().&=+$%-]+: )?[0-9a-zA-Z_!~*'().&=+$%-]+@)?(([0-9]{1,3}.){3}[0-9]{1,3}|([0-9a-zA-Z_!~*'()-]+.)*([0-9a-zA-Z][0-9a-zA-Z-]{0,61})?[0-9a-zA-Z].[a-zA-Z]{2,6})(:[0-9]{1,4})?((/?)|(/[0-9a-zA-Z_!~*'().;?:@&=+$,%#-]+)+/?)$");return t.test(e)},t.dateFormat=a,t.formatData=function(e){var t=new URLSearchParams;for(var n in e)t.append(n,e[n]);return t},t.timeAgo=function(e){var t="",n=864e5,a=(new Date).getTime(),o=a-e;if(o<0)return t;var r=o/6e4,i=o/36e5,c=o/n,s=o/6048e5,u=o/2592e6,d=o/31536e6;r=parseInt(r),i=parseInt(i),c=parseInt(c),s=parseInt(s),u=parseInt(u),d=parseInt(d),u>12?t=" "+parseInt(d)+"年前":u>=1&&u<12?t=" "+parseInt(u)+"月前":s>=1&&s<=4?t=" "+parseInt(s)+"周前":c>=1&&c<=6?t=" "+parseInt(c)+"天前":i>=1&&i<=23?t=" "+parseInt(i)+"小时前":r>=1&&r<=59?t=" "+parseInt(r)+"分钟前":o>=0&&o<=6e4&&(t="刚刚");return t},t.timestampToDateTime=function(e){var t=new Date(e);return a("YYYY-mm-dd HH:MM",t)},n("bf0f"),n("18f7"),n("de6c"),n("2425"),n("c9b5"),n("ab80"),n("5c47"),n("23f4"),n("7d2f"),n("9c4e"),n("a1c1"),n("795c"),n("0506"),n("e966")},c60e:function(e,t,n){"use strict";n.r(t);var a=n("9e13"),o=n("a2ae");for(var r in o)["default"].indexOf(r)<0&&function(e){n.d(t,e,(function(){return o[e]}))}(r);n("6ea6");var i=n("828b"),c=Object(i["a"])(o["default"],a["b"],a["c"],!1,null,"edb90f02",null,!1,a["a"],void 0);t["default"]=c.exports},d343:function(e,t,n){var a=n("395e");a.__esModule&&(a=a.default),"string"===typeof a&&(a=[[e.i,a,""]]),a.locals&&(e.exports=a.locals);var o=n("967d").default;o("5147b9b7",a,!0,{sourceMap:!1,shadowMode:!1})},db04:function(e,t,n){"use strict";var a=n("bb80"),o=n("c435"),r=n("9e70"),i=n("f298"),c=n("862c"),s=a(i),u=a("".slice),d=Math.ceil,l=function(e){return function(t,n,a){var i,l,f=r(c(t)),b=o(n),p=f.length,h=void 0===a?" ":r(a);return b<=p||""===h?f:(i=b-p,l=s(h,d(i/h.length)),l.length>i&&(l=u(l,0,i)),e?f+l:l+f)}};e.exports={start:l(!1),end:l(!0)}},eae5:function(e,t,n){"use strict";(function(e){n("6a54");var a=n("f5bd").default;Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var o=a(n("b7c7"));n("926e"),n("bf0f"),n("2797"),n("aa9c"),n("dc69"),n("fd3c"),n("3efd");var r=n("bf47"),i=n("292f"),c=a(n("6e2f")),s=n("10ac"),u=n("afaf"),d={data:function(){return{records:[],recordInput:"",itemAverageHeight:500,scrollTop:1e3,inputBottom:0,userInfo:{},toUid:"",page:1,limit:10,total:0,dataList:[],toUserInfo:{},triggered:!1,version:0,isOpen:!1}},onLoad:function(e){this.toUid=e.toUid,this.userInfo=uni.getStorageSync("userInfo"),this.getToUserInfo()},created:function(){this.createWs()},onShow:function(){this.getList()},onBackPress:function(){},methods:{back:function(){uni.navigateBack({delta:1})},getToUserInfo:function(){var e=this,t={userId:this.toUid};(0,i.getUserInfo)(t).then((function(t){e.toUserInfo=t.data}))},acceptMessage:function(e){var t=this,n=JSON.parse(e);if(Object.getPrototypeOf(n)==Array.prototype){var a={uid:t.toUid};(0,i.getUserInfo)(a).then((function(e){n.forEach((function(n){if(n.sendId==t.toUid){var a={};a.sendUid=n.sendId,a.content=n.content,a.username=e.data.username,a.avatar=e.data.avatar,t.dataList.push(a)}}))}))}},send:function(){var e=this;if(""!=e.recordInput&&null!=e.recordInput){var t={};t.sendUid=e.userInfo.id+"",t.acceptUid=e.toUid+"",t.msgType=1,t.chatType=0,t.content=e.recordInput,(0,r.addChatRecord)(t).then((function(t){var n={};n.sendUid=e.userInfo.id,n.avatar=e.userInfo.avatar,n.content=e.recordInput,e.dataList.push(n),e.recordInput="",e.scrollTop=e.scrollTop+e.itemAverageHeight}))}else uni.showToast({title:"内容不能为空~",icon:"none"})},getList:function(){var e=this,t={sendUid:this.userInfo.id,acceptUid:this.toUid};(0,r.getChatRecord)(this.page,this.limit,t).then((function(t){e.dataList=t.data.records.map((function(e){return e.time=(0,u.timestampToDateTime)(e.timestamp),e})).reverse(),e.total=t.data.total,e.scrollTop=e.scrollTop+e.dataList.length*e.itemAverageHeight}))},focusTextarea:function(e){this.inputBottom=e.detail.height,this.scrollTop+=1},blurTextarea:function(e){this.inputBottom=0,this.scrollTop+=1},onRefresh:function(){var e=this;if(this.createWs(),this.triggered=!0,setTimeout((function(){e.triggered=!1}),1e3),this.page=this.page+1,!(this.dataList.length>=this.total)){var t={sendUid:this.userInfo.id,acceptUid:this.toUid};(0,r.getChatRecord)(this.page,this.limit,t).then((function(t){var n;(n=e.dataList).unshift.apply(n,(0,o.default)(t.data.records.reverse()))}))}},getUserInfo:function(e){uni.navigateTo({url:"/pages/otherUser/otherUser?uid="+e})},createWs:function(){var t=this;c.default.connectSocket({url:"ws://"+s.appConfig.WS_API+uni.getStorageSync("userInfo").id}),c.default.onSocketOpen((function(t){e.log("WebSocket连接已打开！")})),c.default.onSocketError((function(t){e.log("WebSocket连接打开失败，请检查！")})),c.default.onSocketMessage((function(e){t.acceptMessage(e.data)}))}}};t.default=d}).call(this,n("ba7c")["default"])},f298:function(e,t,n){"use strict";var a=n("497b"),o=n("9e70"),r=n("862c"),i=RangeError;e.exports=function(e){var t=o(r(this)),n="",c=a(e);if(c<0||c===1/0)throw new i("Wrong number of repetitions");for(;c>0;(c>>>=1)&&(t+=t))1&c&&(n+=t);return n}}}]);